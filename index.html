<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />

<title>Радио 13</title>
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="css/core.css" rel="stylesheet" type="text/css" />
<!-- <link href="css/jquery.mobile.css" rel="stylesheet" type="text/css" /> -->
</head>
<body>

<div class="container-fluid">
	<div class="row">
		<div id="tabwr" class="tab-content col-sm-12 col-md-12 main">
				<div id="wrapper">
					<div id="comments">
						<div class="imgblock">
							<img id="imgalb" src="images/no-image.jpg">
							<div class="comment">
								<h2 id="artist"></h2>
								<h4 id="song"></h4>
							</div>
						</div>
						
							
							
							<div class="rateWrapper">
								<div class="btn-group" role="group" aria-label="..." style="width: 300px;">
									<div class="btn-group" role="group" style="width: 50%;">
										<button id="votebtnup" type="button" class="btn btn-success rate rateUp" data-item="0" style="width: 100%;">Супер! <t id="upt">+</t><span class="" id="voteiup">0</span></button>
									</div>
									<div class="btn-group" role="group" style="width: 50%;">
										<button id="votebtndown" type="button" class="btn btn-danger rate rateDown" data-item="0" style="width: 100%;">Не нравится <t id="downt">+</t><span class="" id="voteidown">0</span></button>
									</div>
								</div>
							</div>					
						
					</div>
				</div>
				<div id="player" class="col-sm-12 col-md-12 main">
					<div id="jquery_jplayer_1" class="jp-jplayer"></div>
					<div id="jp_container_1" class="jp-audio-stream" role="application" aria-label="media player">
						<div class="jp-type-single">
							<div class="jp-gui jp-interface">
								<div class="jp-controls">
									<button class="jp-play startstream" role="button" tabindex="0">Включить трансляцию!</button>
									<button class="jp-play preloadstream" role="button" tabindex="0">Буферизация, ожидайте...</button>
									<button class="jp-play stopstream" role="button" tabindex="0">Остановить вещание</button>
								</div>
							</div>
							<div class="jp-no-solution alert alert-warning alert-dismissible" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<strong>Дорогой друг!</strong> Твой браузер не поддерживает Flash плеер. Извини, пока мы не придумали решение для воспроизведения без него :(
							</div>
						</div>
					</div>
				</div>

			</div>
			
		</div>
	</div>
</div>
<script src="js/jquery.min.js" type="text/javascript"></script>
<!-- <script src="js/jquery.mobile.min.js" type="text/javascript"></script>-->
<script src="js/core.js" type="text/javascript"></script>
<script src="js/jplayer.min.js" type="text/javascript"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<script>
setInterval(function(){
		$.getJSON("http://app.radio13.ru/chart3/json.php", function(tinfo) {
			var nametrack = tinfo.artist + ' - ' + tinfo.song;
			var imgalb = tinfo.comment;
			if(imgalb == null || imgalb == '') {
				imgalb = 'images/no-image.jpg';
			};
			var trackid = tinfo.id;
			$('#artist').text(tinfo.artist);
			$('#song').text(tinfo.song);
			$('#imgalb').attr('src', imgalb);
			console.log(trackid);
			$('#votebtnup').data('item', trackid);
			$('#votebtndown').data('item', trackid);			
		});
		
		$.getJSON("http://app.radio13.ru/chart3/ajax.php", function(rate) {

			
			var rateid = rate.id;
			var rateusr = rate.usr;
			var rateup = rate.up;
			var ratedown = rate.down;
			$('#votebtnup').attr('data-item', rateid);
			$('#votebtndown').attr('data-item', rateid);
			$('#voteiup').text(rateup);
			$('#voteidown').text(ratedown);
			
			
			if(rateup == 0) {
				$('#upt').fadeOut(650);
			}
			else{
				$('#upt').fadeIn(650);
			};
			if(ratedown == 0) {
				$('#downt').fadeOut(650);
			}
			else{
				$('#downt').fadeIn(650);
			};
			
			if(rateusr == '2') {
				$('#votebtnup').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
				$('#votebtndown').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
			}
			else{			
				$('#votebtnup').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				$('#votebtndown').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				
				if(rateusr == '1') {
					$('#votebtnup').addClass('active');
					$('#votebtndown').removeClass('active');
				}
				else {
					$('#votebtnup').removeClass('active');
					$('#votebtndown').addClass('active');
				};
			};
		});
 }, 25000);
</script>

<script type="text/javascript">
jQuery(document).ready(function(){
$.getJSON("http://app.radio13.ru/chart3/json.php", function(preinfo) {
	var preimgalb = preinfo.comment;
	if(preimgalb == null || preimgalb == '') {
		preimgalb = 'images/no-image.jpg';
	};
	var pretrackid = preinfo.id;
	$('#artist').text(preinfo.artist);
	$('#song').text(preinfo.song);
	$('#imgalb').attr('src', preimgalb);

	$('#votebtnup').data('item', pretrackid);
	$('#votebtndown').data('item', pretrackid);
	
	var pretrateup = preinfo.up;
	var tratedown = preinfo.down;
	$('#voteiup').text(pretrateup);
	$('#voteidown').text(tratedown);
	
	if(pretrateup == 0) {
		$('#upt').fadeOut(650);
		}
		else{
		$('#upt').fadeIn(650);
	};
	if(tratedown == 0) {
		$('#downt').fadeOut(650);
		}
		else{
			$('#downt').fadeIn(650);
	};
});
	var stream = {
		title: "Радио 13 - прямая трансляция (128 kb/s)",
		mp3: "http://play.radio13.ru/64"
	},
	ready = false;

	$("#jquery_jplayer_1").jPlayer({
		ready: function (event) {
			ready = true;
			$(this).jPlayer("setMedia", stream);
		},
		pause: function() {
			$(this).jPlayer("clearMedia");
		},
		error: function(event) {
			if(ready && event.jPlayer.error.type === $.jPlayer.error.URL_NOT_SET) {
				// Setup the media stream again and play it.
				$(this).jPlayer("setMedia", stream).jPlayer("play");
			}
		},
		swfPath: "../dist/jplayer",
		supplied: "m4v",
		preload: "none",
		wmode: "window",
		useStateClassSkin: true,
		autoBlur: false,
		keyEnabled: true
	});
});

</script>
</body>
</html>
