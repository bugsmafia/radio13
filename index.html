<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8" />

<title>Радио 13</title>
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
<link href="css/core.css" rel="stylesheet" type="text/css" />
<!-- <link href="css/jquery.mobile.css" rel="stylesheet" type="text/css" /> -->
<script type="text/javascript" src="cordova.js"></script>
<script>
if (typeof console  != "undefined") 
    if (typeof console.log != 'undefined')
        console.olog = console.log;
    else
        console.olog = function() {};

console.log = function(message) {
    console.olog(message);
    $('#debug').append('<p>' + message + '</p>');
};
console.error = console.debug = console.info =  console.log
</script>	

</head>
<body  onload="onLoad()">

<div class="container-fluid">
	<div class="row">
		<div id="tabwr" class="col-sm-12 col-md-12 main">
				<div id="wrapper">
					<div id="debug" style="
    color: #fff;
    position: absolute;
    top: 0px;
    right: 0px;
    z-index: 1000;
"></div>
					<div id="comments">
						<div class="imgblock">
							<img id="imgalb" src="images/no-image.jpg">
							<div class="comment">
								<h2 id="artist">---</h2>
								<h4 id="song"></h4>
							</div>
						</div>
						
							
							
							<div class="rateWrapper">
								<div class="btn-group" role="group" aria-label="..." style="width: 300px;">
									<div class="btn-group" role="group" style="width: 50%;">
										<button id="votebtnup" type="button" class="btn btn-success rate rateUp" data-item="0" style="width: 100%;">Супер! <t id="upt">+</t><span class="" id="voteiup">0</span></button>
									</div>
									<div class="btn-group" role="group" style="width: 50%;">
										<button id="votebtndown" type="button" class="btn btn-danger rate rateDown" data-item="0" style="width: 100%;">Не нравится <t id="downt">+</t><span class="" id="voteidown">0</span></button>
									</div>
								</div>
							</div>					
						
					</div>
				</div>
				<div id="player" class="col-sm-12 col-md-12 main">
					<div id="jquery_jplayer_1" class="jp-jplayer"></div>
					<div id="jp_container_1" class="jp-audio-stream" role="application" aria-label="media player">
						<div class="jp-type-single">
							<div class="jp-gui jp-interface">
								<div class="jp-controls">
									<button class="jp-play startstream" role="button" tabindex="0">Включить трансляцию!</button>
									<button class="jp-play preloadstream" role="button" tabindex="0">Буферизация, ожидайте...</button>
									<button class="jp-play stopstream" role="button" tabindex="0">Остановить вещание</button>
								</div>
							</div>
							<div class="jp-no-solution alert alert-warning alert-dismissible" role="alert">
								<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
								<strong>Дорогой друг!</strong> Твой браузер не поддерживает Flash плеер. Извини, пока мы не придумали решение для воспроизведения без него :(
							</div>
						</div>
					</div>
				</div>

			</div>
			
		</div>
	</div>
</div>
<script src="js/jquery.min.js" type="text/javascript"></script>
<!-- <script src="js/jquery.mobile.min.js" type="text/javascript"></script>-->
<script src="js/core.js" type="text/javascript"></script>
<script src="js/jplayer.min.js" type="text/javascript"></script>
<!--<script src="js/bootstrap.min.js" type="text/javascript"></script>-->
<script src="js/jgrowl.js" type="text/javascript"></script>

<script type="text/javascript">
    function onLoad() {
        document.addEventListener("deviceready", onDeviceReady, false);
    }

    // device APIs are available
    //
    function onDeviceReady() {
        // Register the event listener
        document.addEventListener("backbutton", onBackKeyDown, false);
		document.addEventListener("menubutton", onMenuKeyDown, false);
		cordova.getAppVersion().then(function (version) {
			$.jGrowl(version, {
				header: 'Версия приложения',
				life: 3000,
				theme: 'default'
			});	
		});
    }

    // Handle the back button
    //
    function onBackKeyDown() {
		$.jGrowl("Еще не реализованно", {
			header: 'Ты нажал ВОЗВРАТ',
			life: 3000,
			theme: 'default'
		});		
    }
	function onMenuKeyDown() {
		$.jGrowl("Еще не реализованно", {
			header: 'Ты вызвал МЕНЮ',
			life: 3000,
			theme: 'default'
		});

 }
$.jGrowl.defaults.closerTemplate = '<div class="inverse">закрыть уведомления</div>';	
    </script>

<script>


jQuery(document).ready(function(){

	var stream = {
		title: "Радио 13 - прямая трансляция (128 kb/s)",
		mp3: "http://play.radio13.ru/"
	},
	ready = false;

	$("#jquery_jplayer_1").jPlayer({
		ready: function (event) {
			ready = true;
			$(this).jPlayer("setMedia", stream);
		},
		pause: function() {
			$(this).jPlayer("clearMedia");
		},
		error: function(event) {
			if(ready && event.jPlayer.error.type === $.jPlayer.error.URL_NOT_SET) {
				// Setup the media stream again and play it.
				$(this).jPlayer("setMedia", stream).jPlayer("play");
			}
		},
		volume: 1,
		supplied: "mp3",
		preload: "none",
		wmode: "window",
		useStateClassSkin: true,
		autoBlur: false,
		keyEnabled: true
	});
	
	
	
	$.getJSON("https://app.radio13.ru/chart4/json.php", function(tinfo) {
			var nametrack = tinfo.artist + ' - ' + tinfo.song;
			var imgalb = tinfo.comment;
			if(imgalb == null || imgalb == '') {
				imgalb = 'images/no-image.jpg';
			};
			var trackid = tinfo.id;
			$('#artist').text(tinfo.artist);
			$('#song').text(tinfo.song);
			$('#imgalb').attr('src', imgalb);
			$('#votebtnup').data('item', trackid);
			$('#votebtndown').data('item', trackid);			
		});
		
		$.getJSON("https://app.radio13.ru/chart4/ajax.php", function(rate) {			
			var rateid = rate.id;
			var rateusr = rate.usr;
			var rateup = rate.up;
			var ratedown = rate.down;
			$('#votebtnup').attr('data-item', rateid);
			$('#votebtndown').attr('data-item', rateid);
			$('#voteiup').text(rateup);
			$('#voteidown').text(ratedown);	
			
			if(rateup == 0) {
				$('#upt').fadeOut(650);
			}
			else{
				$('#upt').fadeIn(650);
			};
			if(ratedown == 0) {
				$('#downt').fadeOut(650);
			}
			else{
				$('#downt').fadeIn(650);
			};
			
			if(rateusr == '2') {
				$('#votebtnup').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
				$('#votebtndown').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
			}
			else{			
				$('#votebtnup').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				$('#votebtndown').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				
				if(rateusr == '1') {
					$('#votebtnup').addClass('active');
					$('#votebtndown').removeClass('active');
				}
				else {
					$('#votebtnup').removeClass('active');
					$('#votebtndown').addClass('active');
				};
			};
		});
	
	
	setInterval(function(){
		$.getJSON("https://app.radio13.ru/chart4/json.php", function(tinfo) {
			var nametrack = tinfo.artist + ' - ' + tinfo.song;
			var imgalb = tinfo.comment;
			if(imgalb == null || imgalb == '') {
				imgalb = 'images/no-image.jpg';
			};
			var trackid = tinfo.id;
			$('#artist').text(tinfo.artist);
			$('#song').text(tinfo.song);
			$('#imgalb').attr('src', imgalb);
			$('#votebtnup').data('item', trackid);
			$('#votebtndown').data('item', trackid);			
		});
		
		$.getJSON("https://app.radio13.ru/chart4/ajax.php", function(rate) {			
			var rateid = rate.id;
			var rateusr = rate.usr;
			var rateup = rate.up;
			var ratedown = rate.down;
			$('#votebtnup').attr('data-item', rateid);
			$('#votebtndown').attr('data-item', rateid);
			$('#voteiup').text(rateup);
			$('#voteidown').text(ratedown);	
			
			if(rateup == 0) {
				$('#upt').fadeOut(650);
			}
			else{
				$('#upt').fadeIn(650);
			};
			if(ratedown == 0) {
				$('#downt').fadeOut(650);
			}
			else{
				$('#downt').fadeIn(650);
			};
			
			if(rateusr == '2') {
				$('#votebtnup').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
				$('#votebtndown').removeClass('rateDone active').addClass('rate').removeAttr('disabled', 'disabled');
			}
			else{			
				$('#votebtnup').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				$('#votebtndown').removeClass('rate').addClass('rateDone').attr('disabled', 'disabled');
				
				if(rateusr == '1') {
					$('#votebtnup').addClass('active');
					$('#votebtndown').removeClass('active');
				}
				else {
					$('#votebtnup').removeClass('active');
					$('#votebtndown').addClass('active');
				};
			};
		});
		


		window.plugin.notification.local.add({
			id:         1, // is converted to a string
			title:      'Радио 13',
			message:  nametrack, 
			sound: null
		});



	}, 25000);
});
 

</script>
</body>
</html>